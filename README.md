This repository contains all code to reproduce the simulation results in Knowlton, R., Tian, L., & Parast, L. (2025). A General Framework to Assess Complex Heterogeneity in the Strength of a Surrogate Marker. Statistics in Medicine, 44(5), e70001,  https://doi.org/10.1002/sim.70001

To reproduce results, proceed through the following steps. Download all files in this repository and place them in a single folder. These include function files, helper files, and two main files. The two main files are:
sims_complex_master_032924.R and sims_complex_readin.R. The files called sims_runX.R (Setting 1), sims_runX_2.R (Setting 2), and sims_runX_3.R (Setting 3) where X is a number, each run 50 iterations of the 
sims_complex_master_032924.R file. For Setting 1 for example, you will need to run all 20 files: sims_runX.R (designed to run in parallel); this will write results to various files in the folder. Then use the sims_complex_readin.R file to read in all the results and create the table; make sure to set the setting and directory correctly at the top of the sims_complex_readin.R file.

The code for the heatmaps is contained in code_truth_heatmap.R which also requires the results of all simulation runs. The code to examine the assumptions in the simulation settings is in sim.assumptions.R. The code to reproduce the example results and check the assumptions in the example is in aids-example.R; however, since we are not able to provide the data, you cannot exactly reproduce the results. To request the data, you may submit a data request to the ACTG Network at https://actgnetwork.org/submit-a-proposal-2/.
